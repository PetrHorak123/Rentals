@model Rentals.Web.Areas.Admin.Models.ItemTypesViewModel
@using Rentals.Web.Localization

@{
    ViewBag.Title = Admin.Calendar;
}

<h2 class="row">
    @Admin.Calendar
    @Html.ActionLink(Admin.Renting_Create, "Create", "Renting", null, new { @class = "btn btn-primary pull-right" })
</h2>

<h5 class="row">
    @Admin.Calendar_ItemsOverview
</h5>

<div class="row">
    <form id="itemChooser">
        @foreach (var item in Model.ItemTypes)
        {
            <div class="col-xs-12 col-sm-6 col-md-4">
                <input id="@item.Name" type="checkbox" name="@item.Name" value="@item.Id" checked="checked">
                <label for="@item.Name"> @item.Name</label><br>
            </div>
        }
    </form>
</div>

<div class="row">
    <div id="calendar" class="col-xs-12 margin-top-1"></div>
</div>


<script type="text/javascript">
    jq = jQuery.noConflict(false);

	jq(document).ready(function () {
        var searchIDs = jq("#itemChooser input:checkbox:checked").map(function () {
            return parseInt(jq(this).val());
        }).get();;


        jq('#itemChooser :checkbox').change(function () {
            console.log(searchIDs);
            searchIDs = jq("#itemChooser input:checkbox:checked").map(function () {
                return parseInt(jq(this).val());
            }).get();   
            jq("#calendar").fullCalendar('refetchEvents');
        });

		jq("#calendar").fullCalendar({
            defaultView: "month",    
            height: "auto",
            eventOverlap: false,
			locale: "cs",
            slotDuration: "00:@Model.Rental.MinTimeUnit:00",
            allDaySlot: false,
			events: function (start, end, timezone, callback) {
                console.log(searchIDs);
				jq.ajax({
					url: '@Url.Action("GetCalendarEventsForSelectedItemTypes", "Calendar")',
					method: 'get',
					traditional: true,
					data: {
                        itemtypes: searchIDs,
						from: start.toJSON(),
						to: end.toJSON()
					},
					success: function (data) {
						callback(data);
					},
					error: function () {
						alert("Kalendářová chyba");
					}
				});
			}
		});
	});
</script>